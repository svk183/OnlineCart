"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const schematics_1 = require("@angular-devkit/schematics");
const versions_1 = require("../../utils/versions");
const workspace_1 = require("@nrwl/workspace");
const workspace_2 = require("@nrwl/workspace");
function checkDependenciesInstalled() {
    return (host) => {
        const packageJson = workspace_1.readJsonInTree(host, 'package.json');
        const dependencyList = [];
        if (!packageJson.devDependencies.cypress) {
            dependencyList.push({ name: 'cypress', version: versions_1.cypressVersion });
        }
        if (!packageJson.devDependencies['@nrwl/cypress']) {
            dependencyList.push({ name: '@nrwl/cypress', version: versions_1.nxVersion });
        }
        if (!dependencyList.length) {
            return schematics_1.noop();
        }
        return workspace_2.addDepsToPackageJson({}, dependencyList.reduce((dictionary, value) => {
            dictionary[value.name] = value.version;
            return dictionary;
        }, {}));
    };
}
function removeDependency() {
    return workspace_2.updateJsonInTree('package.json', json => {
        json.dependencies = json.dependencies || {};
        delete json.dependencies['@nrwl/cypress'];
        return json;
    });
}
function default_1(schema) {
    return schematics_1.chain([removeDependency(), checkDependenciesInstalled()]);
}
exports.default = default_1;
