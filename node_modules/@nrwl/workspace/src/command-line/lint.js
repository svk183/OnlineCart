"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const shared_1 = require("./shared");
const workspace_integrity_checks_1 = require("./workspace-integrity-checks");
const path = require("path");
const app_root_1 = require("../utils/app-root");
const output_1 = require("./output");
function workspaceLint() {
    const nodes = shared_1.getProjectNodes(shared_1.readWorkspaceJson(), shared_1.readNxJson());
    const cliErrorOutputConfigs = new workspace_integrity_checks_1.WorkspaceIntegrityChecks(nodes, readAllFilesFromAppsAndLibs()).run();
    if (cliErrorOutputConfigs.length > 0) {
        cliErrorOutputConfigs.forEach(errorConfig => {
            output_1.output.error(errorConfig);
        });
        process.exit(1);
    }
}
exports.workspaceLint = workspaceLint;
function readAllFilesFromAppsAndLibs() {
    return [
        ...shared_1.allFilesInDir(`${app_root_1.appRootPath}/apps`).map(f => f.file),
        ...shared_1.allFilesInDir(`${app_root_1.appRootPath}/libs`).map(f => f.file)
    ].filter(f => !path.basename(f).startsWith('.'));
}
