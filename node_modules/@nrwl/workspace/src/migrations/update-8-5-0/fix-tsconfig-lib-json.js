"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ast_utils_1 = require("../../utils/ast-utils");
function default_1() {
    return (host) => {
        const config = ast_utils_1.readWorkspace(host);
        const configsToUpdate = [];
        Object.keys(config.projects).forEach(name => {
            const project = config.projects[name];
            if (project.projectType === 'library' &&
                project.architect &&
                project.architect.test &&
                project.architect.test.builder === '@nrwl/jest:jest' &&
                project.architect.test.options &&
                project.architect.test.options.setupFile ===
                    project.sourceRoot + '/test-setup.ts') {
                configsToUpdate.push(project.root + '/tsconfig.lib.json');
            }
        });
        configsToUpdate.forEach(config => {
            const tsconfig = ast_utils_1.readJsonInTree(host, config);
            if (tsconfig.exclude && tsconfig.exclude[0] === 'src/test.ts') {
                tsconfig.exclude[0] = 'src/test-setup.ts';
                host.overwrite(config, JSON.stringify(tsconfig));
            }
        });
    };
}
exports.default = default_1;
