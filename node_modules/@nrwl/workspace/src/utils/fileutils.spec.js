"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fileutils_1 = require("./fileutils");
const fs = require("fs");
describe('fileutils', () => {
    describe('sortApps', () => {
        it('should handle undefined', () => {
            expect(fileutils_1.addApp(undefined, { name: 'a' })).toEqual([{ name: 'a' }]);
        });
        it('should handle an empty array', () => {
            expect(fileutils_1.addApp([], { name: 'a' })).toEqual([{ name: 'a' }]);
        });
        it('should sort apps by name', () => {
            expect(fileutils_1.addApp([{ name: 'a' }, { name: 'b' }], { name: 'c' })).toEqual([
                { name: 'a' },
                { name: 'b' },
                { name: 'c' }
            ]);
        });
        it('should put workspaceRoot last', () => {
            expect(fileutils_1.addApp([{ name: 'a' }, { name: 'z' }], { name: '$workspaceRoot' })).toEqual([{ name: 'a' }, { name: 'z' }, { name: '$workspaceRoot' }]);
        });
        it('should prioritize apps with "main" defined', () => {
            expect(fileutils_1.addApp([{ name: 'c' }, { name: 'a' }, { name: 'a', main: 'a' }], {
                name: 'b',
                main: 'b'
            })).toEqual([
                { name: 'a', main: 'a' },
                { name: 'b', main: 'b' },
                { name: 'a' },
                { name: 'c' }
            ]);
        });
    });
    describe('createDirectory', () => {
        let fakeExistingDirectories;
        beforeEach(() => {
            fakeExistingDirectories = new Set();
            fakeExistingDirectories.add('/a');
            spyOn(fs, 'mkdirSync').and.callFake(path => {
                fakeExistingDirectories.add(path);
            });
            spyOn(fs, 'statSync').and.callFake(path => {
                return {
                    isDirectory: () => fakeExistingDirectories.has(path)
                };
            });
        });
        it('should recursively create the directory', () => {
            fileutils_1.createDirectory('/a/b/c');
            const expectedSet = new Set(['/a', '/a/b', '/a/b/c']);
            expect(fakeExistingDirectories).toEqual(expectedSet);
        });
    });
});
